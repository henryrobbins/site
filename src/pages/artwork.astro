---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import { Card, Link } from "@heroui/react";

const artwork = await getCollection("artwork");
const exhibitions = await getCollection("exhibitions");

// Helper function to get first image from images object/array
function getFirstImage(images) {
  if (!images) return null;

  // If images is an object with key-value pairs
  if (typeof images === "object" && !Array.isArray(images)) {
    const firstKey = Object.keys(images)[0];
    return firstKey ? images[firstKey] : null;
  }

  // If images is an array
  if (Array.isArray(images) && images.length > 0) {
    return images[0];
  }

  return null;
}
---

<Layout title="Artwork" description="A collection of my artwork.">
  <h2 class="text-lg font-semibold text-center pb-6">EXHIBITIONS</h2>
  <div class="flex flex-row flex-wrap gap-6 items-center justify-center">
    {
      exhibitions
        .sort((a, b) => b.data.year - a.data.year)
        .map((artwork) => (
          <Link href={`/artwork/${artwork.data.id}`} className="text-white">
            <Card radius="none" shadow="none" className="w-64 h-64">
              <div class="absolute inset-0 overflow-hidden">
                <Image
                  src={
                    import(
                      `/assets/${artwork.data.images}/${artwork.data.thumbnail}`
                    )
                  }
                  alt={artwork.data.name}
                  class="w-full h-full object-cover"
                  quality={100}
                  loading={"lazy"}
                />
              </div>

              <div class="absolute bottom-0 left-0 right-0 p-4 text-white backdrop-blur-sm bg-black/50">
                {artwork.data.name} ({artwork.data.year})
              </div>
            </Card>
          </Link>
        ))
    }
  </div>

  <div class="my-8"></div>

  <h2 class="text-lg text-center font-semibold pb-6">WORK</h2>
  <div class="flex flex-row flex-wrap gap-6 items-center justify-center">
    {
      artwork
        .sort(
          (a, b) =>
            new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
        )
        .map((artwork) => (
          <Link href={`/artwork/${artwork.data.id}`} className="text-white">
            <Card radius="none" shadow="none" className="w-64 h-64">
              <div class="absolute inset-0 overflow-hidden">
                {artwork.data.images && getFirstImage(artwork.data.images) && (
                  <Image
                    src={
                      import(`/assets/${getFirstImage(artwork.data.images)}`)
                    }
                    alt={artwork.data.title}
                    class="w-full h-full object-cover"
                    quality={100}
                    loading={"lazy"}
                  />
                )}
              </div>

              <div class="absolute bottom-0 left-0 right-0 p-4 text-white backdrop-blur-sm bg-black/50">
                {artwork.data.title}{" "}
                {`(${new Date(artwork.data.date).getFullYear()})`}
              </div>
            </Card>
          </Link>
        ))
    }
  </div>
</Layout>
